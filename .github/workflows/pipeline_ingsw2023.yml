# This workflow will build a .NET project
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-net

name: MiPrimerPipeline

on:
  push:
    branches: [ "other" ]

jobs:
  build:
    name: Build and Test Job
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Setup .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: 6.0.x
    - name: Restore dependencies
      run: dotnet restore
    - name: Build
      run: dotnet build --no-restore
    - name: Test
      run: dotnet test --no-build --verbosity normal
  
  deploy:
    name: Deploy Job
    needs: [build]
    runs-on: ubuntu-latest
    steps:
    - name: Deploy
      uses: Azure/static-web-apps-deploy@v1
      with:
        azure_static_web_apps_api_token: ${{ secrets.AZURE_STATIC_WEB_APPS_API_TOKEN_LEMON_GROUND_01BD0960F }}
        repo_token: ${{ secrets.GITHUB_TOKEN }} # Used for Github integrations (i.e. PR comments)
        action: "upload"
        app_location: "ingsw2023" # App source code path
        output_location: "wwwroot" # Built app content directory - optional

  feedbackBuildFailure: 
      needs: [build]
      if: failure()
      runs-on: ubuntu-latest
      steps: 
        - name: Slack Notification
          uses: rtCamp/action-slack-notify@v2
          env:
            SLACK_CHANNEL: general
            SLACK_COLOR: '#fc1500'
            SLACK_ICON: https://github.com/rtCamp.png?size=48
            SLACK_MESSAGE: 'Fallo al hacer el build'
            SLACK_TITLE: Build Status
            SLACK_USERNAME: Slack Bot
            SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
